\include{"../preamble.tex"}
\title{ECE 133A HW 6}
\begin{document}
\maketitle
\section*{Exercise A9.4}
Since $A=T(B)$, $D_v=T(E)$, and $D_h=T(E^T)$, and letting
$b$, $e$, and $f$ being the column major ordering of $B$, $E$ and  
We have that since $W$ is symmetric, $\tilde{W}$ is symmetric. and thus we have that 
$$A^T=\frac{1}{n^2}\tilde{W}\textbf{diag}(\tilde{W}b)\tilde{W}^H$$
And the same for $D_v^T$ and $D_h^T$. Thus we have that
Thus we get that 
$$A^TA=\tilde{W}\left(\textbf{diag}(\tilde{W}b)\right)^2\tilde{W}^Hx$$
And likewise for $D_v^TD_v$ and $D_h^TD_h$. Thus we have that
$$(A^TA+\lambda D^T_vD_v+\lambda D^T_hD_h)x=A^Ty$$
becomes:
\begin{align*}
    \tilde{W}\left(\left(\textbf{diag}(\tilde{W}b)\right)^2 +\lambda \left(\textbf{diag}(\tilde{W}e)\right)^2 
            +\lambda \left(\textbf{diag}(\tilde{W}f)\right)^2\right)\tilde{W}^Hx
            &=\frac{1}{n^2}\tilde{W}\textbf{diag}(\tilde{W}b)\tilde{W}^Hy\\
            \left(\left(\textbf{diag}(\tilde{W}b)\right)^2 +\lambda \left(\textbf{diag}(\tilde{W}e)\right)^2 
            +\lambda \left(\textbf{diag}(\tilde{W}f)\right)^2\right)\tilde{W}^Hx
            &=\frac{1}{n^2}\textbf{diag}(\tilde{W}b)\tilde{W}^Hy
\end{align*}
let $z=\tilde{W}^Hx$ Then we get
$$\left(\left(\textbf{diag}(\tilde{W}b)\right)^2 +\lambda \left(\textbf{diag}(\tilde{W}e)\right)^2 
            +\lambda \left(\textbf{diag}(\tilde{W}f)\right)^2\right)z
            =\frac{1}{n^2}\textbf{diag}(\tilde{W}b)\tilde{W}^Hy$$
Then solving for $\tilde{W}b$, $\tilde{W}e$, and $\tilde{W}f$ and $\frac{1}{n^2}\tilde{W}^Hy$ 
will cost $n^2\log(n)$ flops each, and then solving for 
$\left(\left(\textbf{diag}(\tilde{W}b)\right)^2 +\lambda \left(\textbf{diag}(\tilde{W}e)\right)^2 
+\lambda \left(\textbf{diag}(\tilde{W}f)\right)^2\right)$ will cost 
us $7n$ flops. Likewise solving for $\frac{1}{n^2}\textbf{diag}(\tilde{W}b)\tilde{W}^Hy$
is just element wise multiplication of $\frac{1}{n^2}\tilde{W}^Hy$ and 
$\tilde{W}b$ which is $n$ flops. Then we can solve for 
$z$ by dividing $\frac{1}{n^2}\textbf{diag}(\tilde{W}b)\tilde{W}^Hy$
by $\left(\left(\textbf{diag}(\tilde{W}b)\right)^2 +\lambda \left(\textbf{diag}(\tilde{W}e)\right)^2
+\lambda \left(\textbf{diag}(\tilde{W}f)\right)^2\right)$
element wise which will cost us $n$ flops. Then we can solve for $x$ by 
just multiplying $z$ with $\frac{1}{n^2}\tilde{W}$ 
or in other words, dong the FFT on $z$ and then multiplying each
value by $\frac{1}{n^2}$, which will cost us $n^2\log(n)+n+1$ flops. 
Therefore in total our algorithm will cost us 
$5n^2\log(n)+10n+1$ flops.

\section*{Exercise A10.1}
\subsection*{(a)}
Let $u=[u(0),u(1),\cdots,u(N-1)]^T$, then we have that $x=u$
we want to minimize the energy or 
$$||u||^2$$
Furthermore we can express 
$$s_1(N)=0.1u(N-2)+(0.95+1)\cdot 0.1 u(N-3)+(0.95^2+0.95+1)\cdot 0.1 u(N-4)+\cdots+(\sum_{i=0}^{N-2}0.95^i)\cdot 0.1 u(0)$$
$$s_2(N)=0.1u(N-1)+(0.95)\cdot 0.1 u(N-2)+(0.95^2)\cdot 0.1 u(N-3)+\cdots+(0.95^{N-1})\cdot 0.1 u(0)$$
So therefore we have that 
$$C=\begin{bmatrix}
    0.1\sum_{i=0}^{N-2}0.95^i & \cdots & 0.1(0.95+1) & 0.1 & 0\\
    0.1(0.95^{N-1}) & \cdots & 0.1(0.95^2) &  0.1(0.95) & 0.1
\end{bmatrix}$$
And
$$d=\begin{bmatrix}
    10\\
    0
\end{bmatrix}$$
\subsection*{(b)}
\begin{verbatim}
using PyPlot

function create_C(N)
    C = zeros(2,N)

    #make the first row of C 
    for i=1:N-1
        for j=1:N-i
            C[1,i]+=0.1*(0.95^(j-1))
        end
    end
    # C[1,N-1]=0.1 

    #make the second row of C 
    for i=1:N
        C[2,i] = 0.1*(0.95^(N-i))
    end
    return C
end

# calculate u
N=30
C = create_C(N)
d=[10,0]
u = C\d
s1=zeros(N+1)
s2=zeros(N+1)
for i=1:N
    s1[i+1]=s1[i]+s2[i]
    s2[i+1]=0.95*s2[i]+0.1*u[i]
end

fig,axs=subplots(3,1,figsize=(10,12))
axs[1].plot(s1)
axs[1][:set_title]("s1")
axs[2][:plot](s2)
axs[2][:set_title]("s2")
axs[3][:plot](u)
axs[3][:set_title]("u")
axs[3][:set_xlabel]("time")

savefig("problem2a.png")
close()
\end{verbatim}
We get the following plot\\
\includegraphics*[scale=0.4]{problem2a.png}
\subsection*{(c)}
With the following code:
\begin{verbatim}
using PyPlot

function create_C(N)
    C = zeros(2,N)

    #make the first row of C 
    for i=1:N-1
        for j=1:N-i
            C[1,i]+=0.1*(0.95^(j-1))
        end
    end
    # C[1,N-1]=0.1 

    #make the second row of C 
    for i=1:N
        C[2,i] = 0.1*(0.95^(N-i))
    end
    return C
end

N=2:29
println(N)
E=zeros(length(N))
for i=1:length(N)
    C = create_C(N[i])
    d=[10,0]
    u = C\d
    E[i]=sum(u.^2)
end
plot(N,E)
xlabel("N")
ylabel("E")
yscale("log")
savefig("problem2b.png")
close()
\end{verbatim}
We get the following plot\\
\includegraphics*[scale=0.7]{problem2b.png}
\section*{Exercise A10.9}
\subsection*{(a)}
We use Langrage multipliers to solve this problem.\\
$$L(x)=||Ax-b||^2+\lambda e_i^T x$$
\begin{align*}
    \nabla L(x)&=0\\
    2A^T(Ax-b)+\lambda e_i&=0\\
    2A^TAx&=2A^Tb-\lambda e_i\\
    A^TAx&=A^Tb-\frac{\lambda}{2} e_i\\
    x&=(A^TA)^{-1}A^Tb-\frac{\lambda}{2}(A^TA)^{-1}e_i\\
    x&=\hat{x}-\frac{\lambda}{2}(A^TA)^{-1}e_i
\end{align*}
subsituting this back into the constraint we get
\begin{align*}
    e_i^T x&=0\\
    e_i^T\left(\hat{x}-\frac{\lambda}{2}(A^TA)^{-1}e_i\right)&=0\\
    \hat{x}_i-\frac{\lambda}{2}(A^TA)^{-1}_{ii}&=0\\
    \hat{x}_i&=\frac{\lambda}{2}(A^TA)^{-1}_{ii}
    \lambda=\frac{2\hat{x}_i}{(A^TA)^{-1}_{ii}}
\end{align*}
And thus we get that
$$x=\hat{x}-\frac{\hat{x}_i}{(A^TA)^{-1}_{ii}}(A^TA)^{-1}e_i$$
\subsection*{(b)}
Calculating the QR factorization of A costs $2mn^2$ flops. 
And solving $\hat{x}$ costs an additional $2mn+n^2$ flops.
Then we can solve for $(A^TA)^{-1}e_i$ using 
backwards and forwards substitution which costs $2n^2$ flops, and 
then finding $(A^TA)^{-1}_{ii}$ is just finding the value
for the ith index in the vector $(A^TA)^{-1}e_i$ which costs $0$ flops.
This is the same for $\hat{x}_i$. Then calculating 
$\frac{\hat{x}_i}{(A^TA)^{-1}_{ii}}$ costs $1$ flops, and then multiplying
that to every value of $(A^TA)^{-1}e_i$ costs $n$ flops. And then subtracting the resulting
vector from $\hat{x}$ will cost $n$ flops. So the total cost is
$\boxed{2mn^2+2mn+3n^2+2n+1}$ flops.
\end{document}